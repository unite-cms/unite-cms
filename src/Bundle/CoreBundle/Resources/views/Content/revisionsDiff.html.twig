{% extends '@UniteCMSCore/layout.html.twig' %}
{% block title %}
    {% if secondRevision is not defined %}
        {% trans with {"%content%": content|escape, "%version%": firstRevision.version } %}content.revisions.view.title{% endtrans %}
    {% else %}
        {% trans with {"%content%": content|escape, "%version1%": firstRevision.version, "%version2%": secondRevision.version } %}content.revisions.diff.title{% endtrans %}
    {% endif %}
{% endblock title %}
{% block navigation %}{{ include('@UniteCMSCore/Domain/_navigation.html.twig') }}{% endblock navigation %}
{% block content %}
<article class="uk-card uk-card-default uk-card-body full-content-card uk-flex-1">
    <header class="uk-card-header uk-flex revision-diff-header">
        <a class="back-button" href="{{ url('unitecms_core_content_revisions', [view, content]) }}"><i data-feather="arrow-left"></i></a>
        <h2 class="uk-flex-1">
            {% if secondRevision is not defined %}
                {% trans with {"%content%": content|escape, "%version%": firstRevision.version } %}content.revisions.view.headline{% endtrans %}
            {% else %}
                {% trans with {"%content%": content|escape, "%version1%": firstRevision.version, "%version2%": secondRevision.version } %}content.revisions.diff.headline{% endtrans %}
            {% endif %}
        </h2>
        <button class="uk-button uk-button-default actions-dropdown" type="button"><i data-feather="more-horizontal"></i></button>
        <div uk-dropdown="mode: click; pos: bottom-right; offset: 5">
            <ul class="uk-nav uk-dropdown-nav">
                <li><a href="{{ url('unitecms_core_content_revisions', [view, content]) }}"><i class="uk-margin-small-right" data-feather="skip-back"></i>{% trans %}content.revisions.button{% endtrans %}</a></li>
                {% if secondRevision is not defined %}
                    <li><a href="{{ url('unitecms_core_content_revisionsrevert', {'view': view, 'content': content, 'version': firstRevision.version }) }}" class="uk-text-danger"><i class="uk-margin-small-right" data-feather="rewind"></i>{% trans %}content.revisions.revert.button{% endtrans %}</a></li>
                {% endif %}
            </ul>
        </div>
    </header>
    {% if secondRevision is defined %}
        <div class="uk-child-width-expand@s uk-grid-collapse revision-diff-info-container" uk-grid>
            <div class="uk-text-left">
                <div>Version: {{ firstRevision.version }}</div>
                {% if firstRevision.description is not null %}
                    <div>Description: {{ firstRevision.description }}</div>
                {% endif %}
                <div>
                    <span>Timestamp: {{ firstRevision.timestamp|date }}</span>
                </div>
                <div>
                    <span>Actor: {{ firstRevision.actor }}</span>
                    <span>Action: {{ firstRevision.action }}</span>
                </div>
            </div>
            <div class="uk-text-right">
                <div>Version: {{ secondRevision.version }}</div>
                {% if secondRevision.description is not null %}
                    <div>Description: {{ secondRevision.description }}</div>
                {% endif %}
                <div>
                    <span>Timestamp: {{ secondRevision.timestamp|date }}</span>
                </div>
                <div>
                    <span>Actor: {{ secondRevision.actor }}</span>
                    <span>Action: {{ secondRevision.action }}</span>
                </div>
            </div>
        </div>
        {# This acediff component must be put as direct child of uk-card #}
        {# because it has JS code to auto-calculate the height #}
        {{ include('@UniteCMSCore/Domain/_change_visualization.html.twig', { original: firstRevision.contentJson, updated: secondRevision.contentJson}) }}
    {% else %}
        <div class="revision-diff-info-container">
            <div class="uk-text-left">
                <div>Version: {{ firstRevision.version }}</div>
                {% if firstRevision.description is not null %}
                    <div>Description: {{ firstRevision.description }}</div>
                {% endif %}
                <div>
                    <span>Timestamp: {{ firstRevision.timestamp|date }}</span>
                </div>
                <div>
                    <span>Actor: {{ firstRevision.actor }}</span>
                    <span>Action: {{ firstRevision.action }}</span>
                </div>
            </div>
        </div>
        <div id="content-revision-view">{{ firstRevision.contentJson }}</div>
        <script>
            let editor = ace.edit("content-revision-view");
            editor.getSession().setMode('ace/mode/json');
            editor.setReadOnly(true);
            editor.setOptions({
                enableBasicAutocompletion: true,
                enableSnippets: true,
                highlightActiveLine: false,
                tabSize: 2,
                useSoftTabs: true,
            });

            editor.$blockScrolling = 'Infinity';
        </script>
    {% endif %}
</article>
{% endblock content %}
